.. _blueprints:

ç”¨è“å›¾å®ç°æ¨¡å—åŒ–åº”ç”¨
====================================

.. versionadded:: 0.7

Flask ä½¿ç”¨äº† *è“å›¾* çš„æ¦‚å¿µåœ¨ä¸€ä¸ªåº”ç”¨æˆ–è€…è·¨åº”ç”¨ä¸­æ„å»ºåº”ç”¨ç»„ä»¶ä»¥åŠæ”¯æŒé€šç”¨æ¨¡å¼ã€‚
è“å›¾å¾ˆå¥½åœ°ç®€åŒ–äº†å¤§å‹åº”ç”¨å·¥ä½œçš„æ–¹å¼ï¼Œå¹¶æä¾›ç»™ Flask æ‰©å±•åœ¨åº”ç”¨ä¸Šæ³¨å†Œæ“ä½œçš„æ ¸å¿ƒæ–¹æ³•ã€‚
ä¸€ä¸ª :class:`Blueprint` å¯¹è±¡ä¸ :class:`Flask` åº”ç”¨å¯¹è±¡çš„å·¥ä½œæ–¹å¼å¾ˆåƒï¼Œä½†å®ƒç¡®å®ä¸æ˜¯ä¸€ä¸ªåº”ç”¨ï¼Œ
è€Œæ˜¯ä¸€ä¸ªæè¿°å¦‚ä½•æ„å»ºæˆ–æ‰©å±•åº”ç”¨çš„ *è“å›¾* ã€‚

ä¸ºä»€ä¹ˆç”¨è“å›¾ï¼Ÿ
---------------

Flaskä¸­çš„è“å›¾æ—¨åœ¨é’ˆå¯¹è¿™äº›æƒ…å†µï¼š

* æŠŠä¸€ä¸ªåº”ç”¨åˆ†è§£æˆä¸€ç³»åˆ—çš„è“å›¾ã€‚å¯¹äºå¤§å‹çš„åº”ç”¨æ˜¯ç†æƒ³åŒ–çš„ï¼›ä¸€ä¸ªé¡¹ç›®èƒ½å®ä¾‹åŒ–ä¸€ä¸ªåº”ç”¨ï¼Œ
  åˆå§‹åŒ–ä¸€äº›æ‰©å±•ï¼Œä»¥åŠæ³¨å†Œä¸€ç³»åˆ—çš„è“å›¾ã€‚
* ä»¥ä¸€ä¸ª URL å‰ç¼€å’Œ/æˆ–å­åŸŸåœ¨ä¸€ä¸ªåº”ç”¨ä¸Šæ³¨å†Œè“å›¾ã€‚
  URL å‰ç¼€/å­åŸŸåä¸­çš„å‚æ•°å³æˆä¸ºè¿™ä¸ªè“å›¾ä¸‹çš„æ‰€æœ‰è§†å›¾å‡½æ•°çš„å…±åŒçš„è§†å›¾å‚æ•°ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ã€‚
* åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ç”¨ä¸åŒçš„ URL è§„åˆ™å¤šæ¬¡æ³¨å†Œä¸€ä¸ªè“å›¾ã€‚
* é€šè¿‡è“å›¾æä¾›æ¨¡æ¿è¿‡æ»¤å™¨ã€é™æ€æ–‡ä»¶ã€æ¨¡æ¿å’Œå…¶å®ƒåŠŸèƒ½ã€‚ä¸€ä¸ªè“å›¾ä¸ä¸€å®šè¦å®ç°åº”ç”¨æˆ–è§†å›¾å‡½æ•°
* åˆå§‹åŒ–ä¸€ä¸ª Flask æ‰©å±•æ—¶ï¼Œåœ¨è¿™äº›æƒ…å†µä¸­æ³¨å†Œè“å›¾ã€‚

Flask ä¸­çš„è“å›¾ä¸æ˜¯å³æ’åº”ç”¨ï¼Œå› ä¸ºå®ƒå®é™…ä¸Šå¹¶ä¸æ˜¯ä¸€ä¸ªåº”ç”¨â€”â€”å®ƒæ˜¯å¯ä»¥æ³¨å†Œï¼Œç”šè‡³ å¯ä»¥å¤šæ¬¡æ³¨å†Œåˆ°åº”ç”¨ä¸Šçš„æ“ä½œé›†åˆã€‚ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šä¸ªåº”ç”¨å¯¹è±¡ï¼Ÿä½ å¯ä»¥åšåˆ°é‚£æ · ï¼ˆè§ :ref:`app-dispatch` ï¼‰ï¼Œä½†æ˜¯ä½ çš„åº”ç”¨ä¼šæœ‰åˆ†å¼€çš„é…ç½®ï¼Œå¹¶åœ¨ WSGI å±‚ç®¡ç†ã€‚

è“å›¾ä½œä¸º Flask å±‚æä¾›åˆ†å‰²çš„æ›¿ä»£ï¼Œå…±äº«åº”ç”¨é…ç½®ï¼Œå¹¶ä¸”å¯ä»¥æ›´æ”¹æ‰€æ³¨å†Œçš„åº”ç”¨å¯¹ è±¡ã€‚å…¶çŸ­æ¿æ˜¯ä½ ä¸èƒ½åœ¨åº”ç”¨åˆ›å»ºåæ’¤é”€æ³¨å†Œä¸€ä¸ªè“å›¾è€Œä¸é”€æ¯æ•´ä¸ªåº”ç”¨å¯¹è±¡ã€‚

è“å›¾çš„æ¦‚å¿µ
-------------------------

è“å›¾çš„åŸºæœ¬è®¾æƒ³æ˜¯å®ƒä»¬è®°å½•æ³¨å†Œåˆ°ä¸€ä¸ªåº”ç”¨æ—¶çš„æ“ä½œæ‰§è¡Œæƒ…å†µã€‚
å½“ä»ä¸€ä¸ªç«¯ç‚¹åˆ°å¦ä¸€ç«¯åˆ†å‘è¯·æ±‚å’Œç”Ÿæˆ URL æ—¶ï¼ŒFlask å…³è”è§†å›¾å‡½æ•°å’Œè“å›¾ã€‚


ç¬¬ä¸€ä¸ªè“å›¾
------------------

è¿™çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªéå¸¸åŸºæœ¬çš„è“å›¾ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦å®ç°ä¸€ä¸ªç®€å•æ¸²æŸ“é™æ€æ¨¡æ¿çš„è“å›¾::

    from flask import Blueprint, render_template, abort
    from jinja2 import TemplateNotFound

    simple_page = Blueprint('simple_page', __name__,
                            template_folder='templates')

    @simple_page.route('/', defaults={'page': 'index'})
    @simple_page.route('/<page>')
    def show(page):
        try:
            return render_template('pages/%s.html' % page)
        except TemplateNotFound:
            abort(404)

å½“æˆ‘ä»¬ä½¿ç”¨ ``@simple_page.route`` è£…é¥°å™¨ç»‘å®šå‡½æ•°æ—¶ï¼Œè“å›¾ä¼šè®°å½•æ³¨å†Œ `show` å‡½æ•°æ³¨å†Œåˆ°åº”ç”¨çš„æ„å›¾ï¼Œ
å½“å®ƒä¹‹åè¢«æ³¨å†Œã€‚æ­¤å¤–ï¼Œå®ƒä¼šç»™å‡½æ•°ååŠ ä¸Šç”± :class:`Blueprint` çš„æ„é€ å‡½æ•°ä¸­ç»™å‡ºçš„è“å›¾çš„åç§°ä½œä¸ºå‰ç¼€
(åœ¨æ­¤ä¾‹ä¸­æ˜¯ ``simple_page`` )ã€‚

æ³¨å†Œè“å›¾
----------------------

å¦‚ä½•æ³¨å†Œè“å›¾äº†ï¼Ÿåƒè¿™æ ·::

    from flask import Flask
    from yourapplication.simple_page import simple_page

    app = Flask(__name__)
    app.register_blueprint(simple_page)

å¦‚æœä½ æ£€æŸ¥æ³¨å†Œåˆ°åº”ç”¨çš„è§„åˆ™ï¼Œä½ å°†ä¼šå‘ç°è¿™äº›::

    [<Rule '/static/<filename>' (HEAD, OPTIONS, GET) -> static>,
     <Rule '/<page>' (HEAD, OPTIONS, GET) -> simple_page.show>,
     <Rule '/' (HEAD, OPTIONS, GET) -> simple_page.show>]

ç¬¬ä¸€ä¸ªæ˜¾ç„¶æ˜¯æ¥è‡ªåº”ç”¨è‡ªèº«ï¼Œç”¨äºé™æ€æ–‡ä»¶ã€‚å…¶å®ƒçš„ä¸¤ä¸ªç”¨äº ``simple_page`` è“å›¾ä¸­çš„ `show` å‡½æ•°ã€‚å¦‚ä½ æ‰€è§ï¼Œå®ƒä»¬çš„å‰ç¼€æ˜¯è“å›¾çš„åç§°ï¼Œå¹¶ä¸”ç”¨ä¸€ä¸ªç‚¹(``.``)æ¥åˆ†å‰²ã€‚

ä¸è¿‡ï¼Œè“å›¾ä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„ä½ç½®æŒ‚è½½::

    app.register_blueprint(simple_page, url_prefix='/pages')

æœç„¶ï¼Œç”Ÿæˆè¿™äº›è§„åˆ™::

    [<Rule '/static/<filename>' (HEAD, OPTIONS, GET) -> static>,
     <Rule '/pages/<page>' (HEAD, OPTIONS, GET) -> simple_page.show>,
     <Rule '/pages/' (HEAD, OPTIONS, GET) -> simple_page.show>]

ä½ å¯ä»¥æ³¨å†Œå¤šæ¬¡ï¼Œè™½ç„¶ä¸æ˜¯æ¯ä¸€ä¸ªè“å›¾è“å›¾å¯èƒ½ä¼šä½œå‡ºé€‚å½“ååº”çš„é¡¶éƒ¨ã€‚
äº‹å®ä¸Šï¼Œå®ƒå–å†³äºå¦‚ä½•å®æ–½çš„è“å›¾ï¼Œå¦‚æœå®ƒå¯ä»¥å®‰è£…å¤šäºä¸€æ¬¡ã€‚

è“å›¾èµ„æº
-------------------

è“å›¾ä¹Ÿå¯ä»¥æä¾›èµ„æºã€‚æœ‰æ—¶å€™ä½ ä¼šåªä¸ºå®ƒæä¾›çš„èµ„æºè€Œå¼•å…¥ä¸€ä¸ªè“å›¾ã€‚

è“å›¾èµ„æºæ–‡ä»¶å¤¹
`````````````````````````

ä¸å¸¸è§„åº”ç”¨ä¸€æ ·ï¼Œè“å›¾è¢«è®¤ä¸ºæ˜¯åŒ…å«åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚è™½ç„¶å¤šä¸ªè“å›¾å¯ä»¥æºè‡ªç›¸åŒçš„æ–‡ä»¶å¤¹ä¸­ï¼Œ
å®ƒå¹¶ä¸å¿…é¡»æ˜¯è¿™ç§æƒ…å†µå¹¶ä¸”é€šå¸¸ä¸å»ºè®®è¿™æ ·åšã€‚

è¿™ä¸ªæ–‡ä»¶å¤¹ä¼šä» :class:`Blueprint` çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­æ¨æ–­å‡ºæ¥ï¼Œé€šå¸¸æ˜¯ `__name__` ã€‚ 
è¿™ä¸ªå‚æ•°å†³å®šå¯¹åº”è“å›¾çš„æ˜¯å“ªä¸ªé€»è¾‘çš„ Python æ¨¡å—æˆ–åŒ…ã€‚å¦‚æœå®ƒæŒ‡å‘ä¸€ä¸ªå­˜åœ¨çš„ Python åŒ…ï¼Œè¿™ä¸ªåŒ…ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å¤¹ï¼‰å°±æ˜¯èµ„æºæ–‡ä»¶å¤¹ã€‚å¦‚æœæ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œ 
æ¨¡å—æ‰€åœ¨çš„åŒ…å°±æ˜¯èµ„æºæ–‡ä»¶å¤¹ã€‚ä½ å¯ä»¥è®¿é—® :attr:`Blueprint.root_path` å±æ€§æ¥æŸ¥çœ‹èµ„æºæ–‡ä»¶å¤¹ä»€ä¹ˆ::

    >>> simple_page.root_path
    '/Users/username/TestProject/yourapplication'

ä½ å¯ä»¥ä½¿ç”¨ :meth:`~Blueprint.open_resource` å‡½æ•°å¿«é€Ÿæ€§è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­æ‰“å¼€èµ„æº::

    with simple_page.open_resource('static/style.css') as f:
        code = f.read()

é™æ€æ–‡ä»¶
````````````

ä¸€ä¸ªè“å›¾å¯ä»¥é€šè¿‡ `static_folder` å…³é”®å­—å‚æ•°æä¾›ä¸€ä¸ªæŒ‡å‘æ–‡ä»¶ç³»ç»Ÿä¸Šæ–‡ä»¶å¤¹çš„è·¯ å¾„ï¼Œæ¥å…¬å¼€ä¸€ä¸ªå¸¦æœ‰é™æ€æ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚è¿™å¯ä»¥æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºè“å›¾æ–‡ä»¶å¤¹çš„è·¯å¾„::

    admin = Blueprint('admin', __name__, static_folder='static')

é»˜è®¤æƒ…å†µä¸‹ï¼Œè·¯å¾„æœ€å³è¾¹çš„éƒ¨åˆ†å°±æ˜¯å®ƒåœ¨ web ä¸Šæ‰€å…¬å¼€çš„åœ°å€ã€‚å› ä¸ºè¿™é‡Œè¿™ä¸ªæ–‡ä»¶å¤¹å«åš ``static`` ï¼Œ
å®ƒä¼šåœ¨è“å›¾ + ``/static`` çš„ä½ç½®ä¸Šå¯ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè“å›¾ä¸º ``/admin`` æŠŠé™æ€æ–‡ä»¶å¤¹æ³¨å†Œåˆ° ``/admin/static`` ã€‚

æœ€åæ˜¯å‘½åçš„ `blueprint_name.static` ï¼Œè¿™æ ·ä½ å¯ä»¥ç”Ÿæˆå®ƒçš„ URL ï¼Œå°±åƒä½ å¯¹åº”ç”¨çš„é™æ€æ–‡ä»¶å¤¹æ‰€åšçš„é‚£æ ·::

    url_for('admin.static', filename='style.css')

æ¨¡æ¿
`````````

å¦‚æœä½ æƒ³è¦è“å›¾å…¬å¼€æ¨¡æ¿ï¼Œä½ å¯ä»¥æä¾› :class:`Blueprint` æ„é€ å‡½æ•°ä¸­çš„ `template_folder` å‚æ•°æ¥å®ç°::

    admin = Blueprint('admin', __name__, template_folder='templates')

åƒå¯¹å¾…é™æ€æ–‡ä»¶ä¸€æ ·ï¼Œè·¯å¾„å¯ä»¥æ˜¯ç»å¯¹çš„æˆ–æ˜¯ç›¸å¯¹è“å›¾èµ„æºæ–‡ä»¶å¤¹çš„ã€‚æ¨¡æ¿æ–‡ä»¶å¤¹ä¼š è¢«åŠ å…¥åˆ°æ¨¡æ¿çš„æœç´¢è·¯å¾„ä¸­ï¼Œä½†æ˜¯æ¯”å®é™…çš„åº”ç”¨æ¨¡æ¿æ–‡ä»¶å¤¹ä¼˜å…ˆçº§ä½ã€‚
è¿™æ ·ï¼Œä½ å¯ä»¥å®¹æ˜“åœ°åœ¨å®é™…çš„åº”ç”¨ä¸­è¦†ç›–è“å›¾æä¾›çš„æ¨¡æ¿ã€‚

é‚£ä¹ˆå½“ä½ æœ‰ä¸€ä¸ª ``yourapplication/admin`` æ–‡ä»¶å¤¹ä¸­çš„è“å›¾å¹¶ä¸”ä½ æƒ³è¦æ¸²æŸ“ ``'admin/index.html'`` æ¨¡æ¿ï¼Œ
ä¸”ä½ å·²ç»æä¾›äº† ``templates`` ä½œä¸º `template_folder` ï¼Œä½ éœ€è¦è¿™æ ·åˆ›å»ºæ–‡ä»¶: ``yourapplication/admin/templates/admin/index.html``ã€‚

æ„å»º URLs
-------------

å½“ä½ æƒ³è¦ä»ä¸€ä¸ªé¡µé¢é“¾æ¥åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œä½ å¯ä»¥åƒé€šå¸¸ä¸€ä¸ªæ ·ä½¿ç”¨ :func:`url_for` å‡½æ•°ï¼Œåªæ˜¯ä½ è¦åœ¨ URL çš„æœ«ç«¯åŠ ä¸Šè“å›¾çš„åç§°å’Œä¸€ä¸ªç‚¹(``.``)ä½œä¸ºå‰ç¼€::

    url_for('admin.index')

æ­¤å¤–ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªè“å›¾çš„è§†å›¾å‡½æ•°æˆ–æ˜¯æ¨¡æ¿ä¸­æƒ³è¦ä»é“¾æ¥åˆ°åŒä¸€è“å›¾ä¸‹å¦ä¸€ä¸ªç«¯ç‚¹ï¼Œ ä½ å¯ä»¥é€šè¿‡å¯¹ç«¯ç‚¹çš„åªåŠ ä¸Šä¸€ä¸ªç‚¹ä½œä¸ºå‰ç¼€æ¥ä½¿ç”¨ç›¸å¯¹çš„é‡å®šå‘::

    url_for('.index')


¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œå®ƒå®é™…ä¸Šé“¾æ¥åˆ° ``admin.index`` ï¼Œå‡å¦‚è¯·æ±‚è¢«åˆ†æ´¾åˆ°ä»»ä½•å…¶å®ƒçš„ admin è“å›¾ç«¯ç‚¹ã€‚e ``'admin/index.html'`` and you have provided
``templates`` as a `template_folder` you will have to create a file like
this: ``yourapplication/admin/templates/admin/index.html``.

æ„å»º URLs
-------------

If you want to link from one page to another you can use the
:func:`url_for` function just like you normally would do just that you
prefix the URL endpoint with the name of the blueprint and a dot (``.``)::

    url_for('admin.index')

Additionally if you are in a view function of a blueprint or a rendered
template and you want to link to another endpoint of the same blueprint,
you can use relative redirects by prefixing the endpoint with a dot only::

    url_for('.index')

This will link to ``admin.index`` for instance in case the current request
was dispatched to any other admin blueprint endpoint.
to any other admin blueprint endpoint.
